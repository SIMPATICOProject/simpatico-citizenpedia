{
  "swagger": "2.0",
  "info": {
    "description": "This is the [![Simpatico](https://simpatico.business-engineering.it/cpd/assets/img/left_simpatico_small.png)](http://www.simpatico-project.eu/) Collaborative Procedure Designer Server **public** API documentation page.",
    "version": "1.0.0",
    "title": "CPD Server",
    "contact": {
      "email": "v.cartelli@business-engineering.it"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "host": "${cpd.server.pub.host}:${cpd.server.pub.port}",
  "basePath": "${cpd.server.baseHref}${cpd.server.api.path}",
  "schemes": [
    "${cpd.server.pub.scheme}"
  ],
  "paths": {
    "/stats/diagram/{diagramId}/eServiceCount": {
      "get": {
        "tags": [
          "stats"
        ],
        "summary": "Fetch the number of e-service in diagram",
        "description": "Fetches the number of all the e-services that are associated to the _Diagram_ identified by **{diagramId}**.",
        "operationId": "getDiagramEServiceCount",
        "parameters": [
          {
            "name": "diagramId",
            "in": "path",
            "description": "ID of diagram",
            "required": true,
            "type": "string",
            "default": "43467de2-9f42-477f-9f00-13b70f53ce24"
          }
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "schema": {
              "title": "EServiceCount",
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "ID of the Diagram",
                  "example": "43467de2-9f42-477f-9f00-13b70f53ce24"
                },
                "count": {
                  "type": "integer",
                  "description": "Number of e-services associated to the Diagram",
                  "example": 1
                }
              },
              "required": [
                "id",
                "count"
              ]
            }
          },
          "400": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/diagram/summary/list": {
      "get": {
        "tags": [
          "summary"
        ],
        "summary": "List all the diagram summaries",
        "description": "Retrieves the list of **all** _DiagramSummary_.",
        "operationId": "getDiagramSummaryList",
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/diagram.Summary"
              }
            }
          },
          "400": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/diagram/eService/{eServiceId}/summary": {
      "get": {
        "tags": [
          "summary"
        ],
        "summary": "Fetch the diagram summary by e-service ID",
        "description": "Retrieves the _DiagramSummary_ for the given e-service **{eServiceId}**.",
        "operationId": "getDiagramEServiceSummary",
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "eServiceId",
            "in": "path",
            "description": "id of e-service",
            "required": true,
            "type": "string",
            "default": "08677aef-2b6d-4fff-bf10-91b2fe82bdc5"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "schema": {
              "$ref": "#/definitions/diagram.Summary"
            }
          },
          "400": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/user/feedback/{fromDateTime}": {
      "get": {
        "tags": [
          "feedback"
        ],
        "summary": "Fetch the list of user feedback",
        "description": "Retrieves the user feedback from the given **{fromDateTime}**.",
        "operationId": "getUserFeedbackFrom",
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "fromDateTime",
            "in": "path",
            "description": "ISO-8601 date-time from which to show the results",
            "required": true,
            "type": "string",
            "default": "2017-02-15T12:32:00+01:00"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "schema": {
              "$ref": "#/definitions/UserFeedbacks"
            }
          },
          "400": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/user/feedback/{fromDateTime}/{toDateTime}": {
      "get": {
        "tags": [
          "feedback"
        ],
        "summary": "Fetch the list of user feedback",
        "description": "Retrieves the user feedback within the range [**{fromDateTime}**,**{toDateTime}**[.",
        "operationId": "getUserFeedback",
        "produces": [
          "application/json"
        ],
        "parameters": [
          {
            "name": "fromDateTime",
            "in": "path",
            "description": "ISO-8601 date-time where the list begins (included)",
            "required": true,
            "type": "string",
            "default": "2017-02-15T12:32:00+01:00"
          },
          {
            "name": "toDateTime",
            "in": "path",
            "description": "ISO-8601 date-time where the list stops (excluded)",
            "required": true,
            "type": "string",
            "default": "2018-01-01"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "schema": {
              "$ref": "#/definitions/UserFeedbacks"
            }
          },
          "400": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "uuid": {
      "type": "string",
      "format": "uuid"
    },
    "url": {
      "type": "string",
      "format": "uri",
      "pattern": "^([a-zA-Z][a-zA-Zd+\\-.]*):\\/\\/"
    },
    "text": {
      "type": "string"
    },
    "non-negative-number": {
      "type": "number",
      "minimum": 0.0
    },
    "date-time": {
      "title": "DateTime",
      "type": "object",
      "properties": {
        "$date": {
          "type": "string",
          "description": "ISO-8601 date-time representation"
        }
      },
      "required": [
        "$date"
      ]
    },
    "model.Notation": {
      "title": "Model Notation",
      "description": "Notation of the Model",
      "type": "string",
      "enum": [
        "model.notation.BPMN",
        "model.notation.FPMN"
      ]
    },
    "diagram.Summary": {
      "title": "Diagram Summary",
      "description": "Diagram Summary",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "diagramId": {
          "type": "string",
          "title": "Diagram Id",
          "description": "ID of the Diagram",
          "example": "43467de2-9f42-477f-9f00-13b70f53ce24"
        },
        "elementId": {
          "type": "string",
          "title": "Diagram Element Id",
          "description": "ID of the Diagram Element"
        },
        "eServiceId": {
          "title": "Diagram Element Id",
          "description": "ID of the E-Service",
          "type": "string"
        },
        "notation": {
          "title": "Notation",
          "description": "Model Notation of the Diagram",
          "$ref": "#/definitions/model.Notation",
          "example": "model.notation.FPMN"
        },
        "name": {
          "title": "Diagram Name",
          "description": "Name of the Diagram",
          "type": "string",
          "example": "Ammissione al servizio di nido d’infanzia"
        },
        "documentation": {
          "title": "Documentation",
          "description": "Documentation of the Diagram",
          "type": "string",
          "example": "Il servizio di asilo nido si propone di offrire il servizio..."
        },
        "path": {
          "title": "Path",
          "description": "Path to the Diagram Element",
          "type": "string",
          "example": "//Ammissione al servizio di nido d’infanzia//Richiesta di ammissione"
        },
        "phases": {
          "title": "Phases",
          "description": "Phases of the Procedure",
          "type": "array",
          "items": {
            "title": "Phase",
            "type": "object",
            "properties": {
              "eServiceId": {
                "type": "string"
              },
              "name": {
                "type": "string",
                "example": "Richiesta di ammissione"
              },
              "documentation": {
                "type": "string"
              }
            },
            "required": [
              "name"
            ]
          }
        },
        "url": {
          "title": "Url",
          "description": "link to the Diagram (with eventually the focused Diagram Element) in the web application",
          "type": "string",
          "example": "https://${cpd.server.pub.host}:${cpd.server.pub.port}${cpd.server.baseHref}en/diagram/43467de2-9f42-477f-9f00-13b70f53ce24"
        },
        "svg": {
          "title": "Svg",
          "description": "link to the svg image of the Diagram",
          "type": "string",
          "example": "https://${cpd.server.pub.host}:${cpd.server.pub.port}${cpd.server.baseHref}assets/svg/43467de2-9f42-477f-9f00-13b70f53ce24.svg"
        }
      },
      "required": [
        "diagramId",
        "notation",
        "name",
        "phases",
        "url",
        "svg"
      ]
    },
    "UserFeedbacks": {
      "title": "UserFeedbackList",
      "description": "The list of user feedbacks within a date-time range",
      "type": "object",
      "properties": {
        "dateTimeRange": {
          "type": "object",
          "properties": {
            "$gte": {
              "$ref": "#/definitions/date-time",
              "example": {
                "$date": "2017-02-15T12:32+01:00"
              }
            },
            "$lt": {
              "$ref": "#/definitions/date-time"
            }
          },
          "required": [
            "$gte"
          ]
        },
        "feedbackList": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "ID of the feedback",
                "example": "4053a4e7-efb1-4c1c-99ba-2ed53176b37e"
              },
              "userId": {
                "type": "string",
                "description": "ID of the user who posted the feedback",
                "example": "citizen 1"
              },
              "message": {
                "type": "string",
                "description": "the posted feedback text",
                "example": "Il permesso potrebbe essere rilasciato via PEC"
              },
              "diagramId": {
                "type": "string",
                "description": "ID of the diagram where the feedback has been posted",
                "example": "62c02032-0b13-436c-9a96-00a7e479801b"
              },
              "elementId": {
                "type": "string",
                "description": "ID of the diagram element where the feedback has been posted",
                "example": "f17b9bf0-f2b7-4eb3-b8a4-0bd638dda677"
              },
              "dateTime": {
                "$ref": "#/definitions/date-time",
                "description": "ISO-8601 date-time of when the feedback has been posted",
                "example": {
                  "$date": "2017-03-15T12:35:20.201Z"
                }
              },
              "path": {
                "type": "string",
                "example": "//Rilascio autorizzazione per attività temporanea (rumore)//Rilascio del permesso"
              },
              "url": {
                "title": "Url",
                "description": "link to the Diagram (with the focused Diagram Element) in the web application",
                "type": "string",
                "example": "https://${cpd.server.pub.host}:${cpd.server.pub.port}${cpd.server.baseHref}en/diagram/62c02032-0b13-436c-9a96-00a7e479801b/f17b9bf0-f2b7-4eb3-b8a4-0bd638dda677"
              },
              "svg": {
                "title": "Svg",
                "description": "link to the svg image of the Diagram",
                "type": "string",
                "example": "https://${cpd.server.pub.host}:${cpd.server.pub.port}${cpd.server.baseHref}assets/svg/62c02032-0b13-436c-9a96-00a7e479801b.svg"
              }
            },
            "required": [
              "id",
              "userId",
              "message",
              "diagramId",
              "elementId",
              "dateTime",
              "path",
              "url"
            ]
          }
        }
      }
    },
    "Error": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "fields": {
          "type": "string"
        }
      },
      "required": [
        "code",
        "message"
      ]
    }
  }
}